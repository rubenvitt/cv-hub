<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>6</storyId>
    <title>Skills Section mit Client-Side-Filterung</title>
    <status>drafted</status>
    <generatedAt>2025-11-14</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/3-6-skills-section-mit-client-side-filterung.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Benutzer der öffentlichen CV-Seite</asA>
    <iWant>eine Skills Section mit filterbaren Skill-Badges sehen</iWant>
    <soThat>ich schnell relevante Skills nach Kategorien (Frontend, Backend, etc.) entdecken kann</soThat>
    <tasks>
## Tasks / Subtasks

- [ ] **Task 1: SkillsSection Component Grundstruktur** (AC: #1, #7)
  - [ ] 1.1: Erstelle `apps/frontend/components/sections/skills-section.tsx` mit TypeScript
  - [ ] 1.2: Definiere Props-Interface `SkillsSectionProps` mit Type `PublicCV['skills']` und `variant: 'public' | 'authenticated'`
  - [ ] 1.3: Implementiere responsive Grid-Layout mit Tailwind CSS (`grid-cols-2` Mobile, `md:grid-cols-4 lg:grid-cols-6` Desktop)
  - [ ] 1.4: Rendere alle Skills als SkillBadge-Components
  - [ ] 1.5: Teste Component isoliert mit React Testing Library

- [ ] **Task 2: SkillBadge UI Component** (AC: #1)
  - [ ] 2.1: Erstelle `apps/frontend/components/ui/skill-badge.tsx` als wiederverwendbare Component
  - [ ] 2.2: Definiere Props-Interface mit `name: string` und `level?: 'Beginner' | 'Intermediate' | 'Advanced' | 'Expert'`
  - [ ] 2.3: Implementiere Badge-Styling mit Tailwind (rounded, padded, colored basierend auf Level)
  - [ ] 2.4: Füge Hover-States und Transitions hinzu (smooth scale-on-hover)
  - [ ] 2.5: Implementiere optionale Level-Indicator (z.B. farbcodiert oder Badge-Variante)
  - [ ] 2.6: Schreibe Unit-Tests für Badge-Component

- [ ] **Task 3: Client-Side Filter State Management** (AC: #2, #3, #4, #5)
  - [ ] 3.1: Implementiere React State für Filter-Logik (`useState` Hook)
  - [ ] 3.2: State-Interface: `SkillsFilterState { selectedCategories: string[] }`
  - [ ] 3.3: Extrahiere eindeutige Kategorien aus `skills[].keywords` (Set-basiert, dedupliziert)
  - [ ] 3.4: Implementiere Filter-Logik: `skills.filter(s => selectedCategories.length === 0 || s.keywords?.some(k => selectedCategories.includes(k)))`
  - [ ] 3.5: Implementiere Multi-Select-Handler für Filter-Dropdown
  - [ ] 3.6: Implementiere "Clear Filters" Button-Handler (resettet State zu `[]`)
  - [ ] 3.7: Optimiere Filter-Performance (memoize gefilterte Skills mit useMemo)

- [ ] **Task 4: Filter UI Component** (AC: #2, #3, #5, #8)
  - [ ] 4.1: Erstelle Filter-Controls UI in SkillsSection (oberhalb Grid)
  - [ ] 4.2: Implementiere Multi-Select-Dropdown mit shadcn/ui (z.B. Checkbox-Group)
  - [ ] 4.3: Zeige alle verfügbaren Kategorien als Checkboxes
  - [ ] 4.4: Implementiere "Clear Filters" Button (nur sichtbar wenn Filter aktiv)
  - [ ] 4.5: Füge ARIA-Labels hinzu (`aria-label="Filter skills by category"`)
  - [ ] 4.6: Style Filter-UI mit Tailwind (responsive, mobile-optimiert)
  - [ ] 4.7: Implementiere Keyboard-Navigation (Tab, Space/Enter für Checkbox-Toggle)

- [ ] **Task 5: Animationen und Transitions** (AC: #6, #9)
  - [ ] 5.1: Implementiere Fade-In/Fade-Out-Animation für gefilterte Skills (Tailwind `transition-opacity duration-300`)
  - [ ] 5.2: Verhindere Layout-Shifts: Grid-Container behält feste Höhe oder smooth collapse
  - [ ] 5.3: Teste Animation-Performance (keine Janks, smooth 60fps)
  - [ ] 5.4: Implementiere Skeleton-Loading-States (optional, falls nötig)
  - [ ] 5.5: Teste CLS-Metrik mit Lighthouse (Target: <0.1)

- [ ] **Task 6: Integration in Public Route** (AC: alle)
  - [ ] 6.1: Importiere SkillsSection in `apps/frontend/app/routes/index.tsx`
  - [ ] 6.2: Übergebe `cv.skills` als Props von Route-Loader-Daten
  - [ ] 6.3: Positioniere SkillsSection nach HeroSection im PublicLayout
  - [ ] 6.4: Teste Integration: SSR rendert Skills-Section korrekt (keine Client-Only-Code-Fehler)

- [ ] **Task 7: Accessibility & Responsive Testing** (AC: #7, #8)
  - [ ] 7.1: Teste Keyboard-Navigation (Tab zu Filter-Controls, Space/Enter für Toggle)
  - [ ] 7.2: Teste Screen-Reader (NVDA/JAWS): Filter-Controls und Skills korrekt vorgelesen
  - [ ] 7.3: Validiere Farb-Kontraste für Skill-Badges (WCAG AA: ≥4.5:1)
  - [ ] 7.4: Teste responsive Breakpoints (320px, 768px, 1024px, 1440px)
  - [ ] 7.5: Validiere Touch-Targets für Mobile (≥44x44px für Filter-Checkboxes)

- [ ] **Task 8: Component Testing** (AC: alle)
  - [ ] 8.1: Schreibe Unit-Tests für SkillsSection Component (Vitest + React Testing Library)
  - [ ] 8.2: Schreibe Unit-Tests für SkillBadge Component
  - [ ] 8.3: Teste Filter-Logik (verschiedene Kategorie-Kombinationen)
  - [ ] 8.4: Teste "Clear Filters" Funktionalität
  - [ ] 8.5: Teste Animation-Behavior (Fade-In/Fade-Out)
  - [ ] 8.6: Teste Edge-Cases (keine Skills, keine Keywords, leere Kategorien)
  - [ ] 8.7: Snapshot-Tests für visuelle Regression-Prevention

- [ ] **Task 9: Performance Testing** (AC: #4, #9)
  - [ ] 9.1: Messe Filter-Latenz mit Chrome DevTools Performance-Tab (Target: <100ms)
  - [ ] 9.2: Teste mit großen Skill-Sets (50+ Skills) für Performance-Validierung
  - [ ] 9.3: Validiere CLS mit Lighthouse (Target: <0.1)
  - [ ] 9.4: Optimiere Re-Renders mit React.memo wenn nötig
  - [ ] 9.5: Profiling mit React DevTools Profiler
    </tasks>
  </story>

  <acceptanceCriteria>
1. **AC-1:** SkillsSection Component rendert alle Skills aus `cv.skills` als visuelle Badges (Tailwind-styled)
2. **AC-2:** Filter-Dropdown zeigt eindeutige Kategorien aus `skills[].keywords` Array
3. **AC-3:** User kann mehrere Kategorien gleichzeitig auswählen (Multi-Select-Filterung)
4. **AC-4:** Filterung erfolgt client-side ohne API-Calls mit instant Feedback (<100ms Latenz)
5. **AC-5:** "Clear Filters" Button resettet alle aktiven Filter auf Anfangszustand
6. **AC-6:** Gefilterte Skills zeigen Fade-In/Fade-Out-Animation (Tailwind Transitions)
7. **AC-7:** Responsive Grid-Layout: Mobile = 2 Spalten, Desktop = 4-6 Spalten
8. **AC-8:** Accessibility: Keyboard-Navigation für Filter-Controls, ARIA-Labels, Screen-Reader-Support
9. **AC-9:** Keine Layout-Shifts während Filterung (Cumulative Layout Shift <0.1)
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <artifact path="docs/tech-spec-epic-3.md" title="Epic 3 Technical Specification" section="Skills Section Component">
        Epic 3 spezifiziert Skills Section mit:
        - Data Model: PublicCV['skills'] Interface (name, level, keywords)
        - Component Requirements: Badge-Grid, Client-Side Filtering, Responsive Layout
        - Filter-Logik: Multi-Select, Instant Feedback (<100ms), keine API-Calls
        - Performance: useMemo für gefilterte Skills, React.memo für SkillBadge
        - Accessibility: WCAG 2.1 Level AA, shadcn/ui Components (Radix UI = accessible by default)
      </artifact>
      <artifact path="docs/architecture.md" title="System Architecture" section="Frontend Stack">
        Frontend-Stack:
        - TanStack Start mit Server-Side Rendering (SSR)
        - React 19 (stable) mit TypeScript (strict mode)
        - TanStack Router v1 für Type-safe Routing
        - Tailwind CSS v4 für Utility-first Styling
        - shadcn/ui Components (Radix UI primitives, WCAG AA)
      </artifact>
      <artifact path="docs/PRD.md" title="Product Requirements Document" section="Client-Side Filtering">
        PRD FR-1.4: Client-Side Filtering
        - Content ist filterbar (Skills nach Kategorie, Projekte nach Jahr)
        - Client-side, ohne Reload, instant Feedback
        - UX Principles: WCAG 2.1 Level AA Compliance, moderne Benutzeroberfläche
      </artifact>
      <artifact path="docs/ux-design-specification.md" title="UX Design Specification" section="Design System - shadcn/ui">
        Design System: shadcn/ui mit Radix UI Primitives
        - Copy-paste Components (kein npm dependency lock-in)
        - WCAG 2.1 AA compliant (Radix UI primitives)
        - TypeScript-native mit full type safety
        - Tailwind CSS customization
        - Components: Button, Badge, Card, Checkbox-Group verfügbar
      </artifact>
    </docs>
    <code>
      <artifact path="packages/shared-types/src/cv-schema.ts" kind="type-definition" symbol="SkillSchema" lines="173-177" reason="Zod schema für Skills mit Runtime-Validation">
        SkillSchema Definition:
        - name: string (max 200, required)
        - level: enum ['Beginner', 'Intermediate', 'Advanced', 'Expert'] (optional)
        - keywords: string[] (max 100 pro keyword, optional) - für Kategorisierung/Filterung
      </artifact>
      <artifact path="apps/frontend/src/lib/api.ts" kind="api-client" symbol="usePublicCV" lines="164-171" reason="TanStack Query Hook für CV-Daten mit Caching">
        usePublicCV() Hook:
        - TanStack Query Integration
        - queryKey: cvQueryKeys.public
        - queryFn: fetchPublicCV
        - Returns: { data: CV, isLoading, isError, error }
        - Caching/Retry in QueryClient konfiguriert (__root.tsx)
      </artifact>
      <artifact path="apps/frontend/src/routes/__root.tsx" kind="config" symbol="queryClient" lines="15-24" reason="QueryClient Config für Caching und Retry">
        QueryClient Configuration:
        - staleTime: 5min (300000ms)
        - gcTime: 10min (600000ms)
        - retry: 2 (max 2 retry attempts)
        - retryDelay: exponential backoff (1s, 2s, max 5s)
      </artifact>
      <artifact path="apps/frontend/src/components/ui/badge.tsx" kind="component" symbol="Badge" reason="shadcn/ui Badge Component als Basis für SkillBadge">
        Existierender Badge Component:
        - Radix UI Primitives
        - Tailwind-styled mit variants (default, secondary, destructive, outline)
        - TypeScript Props-Interface
        - Kann als Basis für SkillBadge verwendet werden
      </artifact>
      <artifact path="apps/frontend/src/components/ui/button.tsx" kind="component" symbol="Button" reason="shadcn/ui Button für Filter-Controls">
        Existierender Button Component:
        - shadcn/ui Standard-Button
        - Variants: default, destructive, outline, secondary, ghost, link
        - Sizes: default, sm, lg, icon
        - Accessible (Radix UI)
        - Für "Clear Filters" Button verwendbar
      </artifact>
      <artifact path="apps/frontend/src/__tests__/api-query.spec.tsx" kind="test" symbol="TestComponent" lines="12-19" reason="Test-Pattern für TanStack Query Hooks">
        Test-Pattern für usePublicCV Hook:
        - QueryClientProvider Wrapper mit test QueryClient
        - Mock fetch globally (vi.fn())
        - Test Loading, Error, Success States
        - waitFor() für async state changes
        - Pattern kann für SkillsSection Tests wiederverwendet werden
      </artifact>
      <artifact path="apps/frontend/src/routes/index.tsx" kind="route" symbol="Route" reason="Public CV Route - Integration Point für SkillsSection">
        Public CV Route (index.tsx):
        - TanStack Router File-based Route
        - SSR-fähig
        - Loader lädt CV-Daten via fetchPublicCV()
        - SkillsSection wird hier integriert
      </artifact>
    </code>
    <dependencies>
      <react>19.x</react>
      <react-dom>19.x</react-dom>
      <@tanstack/react-router>v1.x</@tanstack/react-router>
      <@tanstack/react-query>Latest</@tanstack/react-query>
      <@tanstack/start>RC → v1.0</@tanstack/start>
      <tailwindcss>v4.x</tailwindcss>
      <@radix-ui/react-*>Latest (via shadcn/ui)</@radix-ui/react-*>
      <zod>v3.x</zod>
      <@cv-hub/shared-types>Workspace (Monorepo Package)</@cv-hub/shared-types>
      <vitest>Latest</vitest>
      <@testing-library/react>Latest</@testing-library/react>
    </dependencies>
  </artifacts>

  <constraints>
## Development Constraints

**SSR-Kompatibilität:**
- Keine Client-Only-Code in SkillsSection initial render
- Filter-State via `useState` (Client-Side Hydration)
- Skills werden SSR-rendered, Filter-Controls hydrated client-side
- No `window` or `localStorage` usage ohne conditional check

**Type-Safety:**
- Props-Interface mit TypeScript Strict Mode
- Runtime-Validation bereits in API-Client (lib/api.ts) via Zod
- Component erhält typisierte Props vom Route-Loader
- Skills Type: `PublicCV['skills']` aus @cv-hub/shared-types

**Error-Handling:**
- Fehlende `skills` Array → Empty State anzeigen ("No skills to display")
- Leere `keywords` → Skill ist in Filter nicht selektierbar (exclude from categories)
- Fehlende `name` → Skill nicht rendern (Required Field)

**Performance:**
- useMemo für gefilterte Skills (verhindert unnötige Re-Renders)
- React.memo für SkillBadge Component (verhindert Re-Render wenn Props gleich)
- No Debouncing nötig (Filter ist instant, keine API-Calls)
- Grid-Layout mit CSS Grid (performanter als Flexbox für viele Items)

**Accessibility:**
- WCAG 2.1 Level AA Compliance (mandatory)
- Semantisches HTML: `<section>` für SkillsSection, `<div role="group">` für Filter-Controls
- ARIA-Labels: Filter-Dropdown (`aria-label="Filter skills by category"`), Clear Button (`aria-label="Clear all filters"`)
- Keyboard-Navigation: Tab zu Filter-Controls, Space/Enter togglet Checkboxes
- Focus-States: Tailwind `focus:ring-2`
- Screen-Reader: Filter-Status wird announced

**Styling Conventions:**
- Tailwind CSS v4 Utility-first
- shadcn/ui Components für UI-Patterns
- Mobile-First Approach (Tailwind-Breakpoints)
- Responsive Grid: `grid-cols-2 md:grid-cols-4 lg:grid-cols-6`
- Animation: Tailwind Transitions (`transition-opacity duration-300 ease-in-out`)

**Testing Requirements:**
- Unit-Tests mit Vitest + React Testing Library
- Accessibility-Tests mit axe-core
- Performance-Tests mit Chrome DevTools
- Snapshot-Tests für visuelle Regression-Prevention
- Coverage Target: >80% Line Coverage
  </constraints>

  <interfaces>
## Component Interfaces

**SkillsSection Props:**
```typescript
interface SkillsSectionProps {
  skills?: PublicCV['skills'];
  variant: 'public' | 'authenticated';
}
```

**SkillBadge Props:**
```typescript
interface SkillBadgeProps {
  name: string;
  level?: 'Beginner' | 'Intermediate' | 'Advanced' | 'Expert';
}
```

**Filter State:**
```typescript
interface SkillsFilterState {
  selectedCategories: string[];
}
```

**Skill Schema (Zod):**
```typescript
export const SkillSchema = z.object({
  name: z.string().max(200),
  level: z.enum(['Beginner', 'Intermediate', 'Advanced', 'Expert']).optional(),
  keywords: z.array(z.string().max(100)).optional(),
});
```

**API Integration:**
- usePublicCV() Hook: Returns `{ data: CV, isLoading, isError, error }`
- cv.skills: `Array<{ name: string; level?: string; keywords?: string[] }>`
  </interfaces>

  <tests>
    <standards>
**Testing Stack:**
- Vitest (3-4x faster than Jest, Vite-native)
- @testing-library/react (user-centric tests)
- @testing-library/jest-dom (assertions)
- axe-core (accessibility testing)

**Test Types:**
- Unit Tests: SkillsSection, SkillBadge, Filter-Logik (70%)
- Integration Tests: API-Integration, Error-Handling (20%)
- E2E Tests: User-Flows mit Playwright (10%)
- Accessibility Tests: axe DevTools, Screen-Reader

**Coverage Target:** >80% Line Coverage
    </standards>
    <locations>
- Unit Tests: `apps/frontend/src/__tests__/*.spec.tsx`
- Component Tests: Co-located mit Components
- E2E Tests: `apps/frontend/e2e/*.spec.ts` (Playwright)
    </locations>
    <ideas>
**Unit Tests for SkillsSection:**
- AC#1: Renders all skills as badges
- AC#2: Extracts unique categories from keywords
- AC#3: Multi-select filter works correctly
- AC#4: Filtering is instant (<100ms, no API calls)
- AC#5: Clear Filters button resets state
- AC#6: Fade animations render correctly
- AC#7: Responsive grid renders at different viewports
- AC#8: Keyboard navigation works (Tab, Enter, Space)
- AC#9: No layout shifts (CLS <0.1)

**Unit Tests for SkillBadge:**
- Renders skill name
- Renders optional level
- Applies correct styling based on level
- Hover states work
- Transitions are smooth

**Integration Tests:**
- Skills data loads from usePublicCV hook
- Empty state shows when no skills
- Error state shows when API fails

**Accessibility Tests:**
- axe-core scan passes with 0 violations
- Keyboard navigation functional (Tab, Space, Enter)
- ARIA labels present and correct
- Screen-reader announcements (manual test)
- Color contrast meets WCAG AA (≥4.5:1)

**Performance Tests:**
- Filter latency <100ms (Chrome DevTools Performance Tab)
- CLS <0.1 (Lighthouse)
- No janky animations (60fps smooth)
- Large skill sets (50+ skills) perform well
    </ideas>
  </tests>
</story-context>
